# ë©”íƒ€ë°ì´í„° ì €ì¥ì†Œ ì•„í‚¤í…ì²˜ ë¹„êµ

> í”„ë¡œì íŠ¸ë³„ _metadata vs ì¤‘ì•™ metadb - ì–´ë–¤ ë°©ì‹ì„ ì„ íƒí• ê¹Œ?

## ğŸ“‹ ìƒí™©

- **í™˜ê²½**: 1ê°œì˜ PostgreSQL ì„œë²„ (Ubuntu Docker í”Œë«í¼)
- **í”„ë¡œì íŠ¸**: ì—¬ëŸ¬ ê°œì˜ ë…ë¦½ì ì¸ í”„ë¡œì íŠ¸
- **DB êµ¬ì¡°**: ê° í”„ë¡œì íŠ¸ëŠ” ë³„ë„ì˜ DB ì‚¬ìš© (ì˜ˆ: project1_db, project2_db, ...)

## ğŸ¯ ë‘ ê°€ì§€ ì˜µì…˜

### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata (ë¶„ì‚°í˜•)

```
PostgreSQL ì„œë²„
â”œâ”€â”€ project1_db
â”‚   â”œâ”€â”€ _metadata schema (project1 ë©”íƒ€ë°ì´í„°)
â”‚   â”‚   â”œâ”€â”€ mappings_table
â”‚   â”‚   â””â”€â”€ mappings_column
â”‚   â””â”€â”€ public schema (project1 ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°)
â”‚       â”œâ”€â”€ users
â”‚       â””â”€â”€ products
â”‚
â”œâ”€â”€ project2_db
â”‚   â”œâ”€â”€ _metadata schema (project2 ë©”íƒ€ë°ì´í„°)
â”‚   â”‚   â”œâ”€â”€ mappings_table
â”‚   â”‚   â””â”€â”€ mappings_column
â”‚   â””â”€â”€ public schema (project2 ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°)
â”‚       â”œâ”€â”€ orders
â”‚       â””â”€â”€ payments
â”‚
â””â”€â”€ project3_db
    â”œâ”€â”€ _metadata schema (project3 ë©”íƒ€ë°ì´í„°)
    â””â”€â”€ public schema (project3 ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°)
```

### ì˜µì…˜ B: ì¤‘ì•™ metadb (ì¤‘ì•™ì§‘ì¤‘í˜•)

```
PostgreSQL ì„œë²„
â”œâ”€â”€ metadb (ëª¨ë“  í”„ë¡œì íŠ¸ì˜ ë©”íƒ€ë°ì´í„°)
â”‚   â””â”€â”€ _metadata schema
â”‚       â”œâ”€â”€ mappings_table (ëª¨ë“  í”„ë¡œì íŠ¸)
â”‚       â”œâ”€â”€ mappings_column (ëª¨ë“  í”„ë¡œì íŠ¸)
â”‚       â”œâ”€â”€ projects (í”„ë¡œì íŠ¸ ëª©ë¡)
â”‚       â””â”€â”€ project_tables (í”„ë¡œì íŠ¸ë³„ í…Œì´ë¸” ë§¤í•‘)
â”‚
â”œâ”€â”€ project1_db
â”‚   â””â”€â”€ public schema (ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°ë§Œ)
â”‚       â”œâ”€â”€ users
â”‚       â””â”€â”€ products
â”‚
â”œâ”€â”€ project2_db
â”‚   â””â”€â”€ public schema (ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°ë§Œ)
â”‚       â”œâ”€â”€ orders
â”‚       â””â”€â”€ payments
â”‚
â””â”€â”€ project3_db
    â””â”€â”€ public schema (ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°ë§Œ)
```

---

## ğŸ“Š ìƒì„¸ ë¹„êµ

### 1. âœ… **ë…ë¦½ì„± (Isolation)**

#### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata â­â­â­â­â­

**ì¥ì :**
- âœ… ì™„ë²½í•œ í”„ë¡œì íŠ¸ ë…ë¦½ì„±
- âœ… í”„ë¡œì íŠ¸ë³„ ë°±ì—…/ë³µì› ìš©ì´
- âœ… í”„ë¡œì íŠ¸ ì‚­ì œ ì‹œ ë©”íƒ€ë°ì´í„°ë„ í•¨ê»˜ ì‚­ì œ (Clean)
- âœ… í”„ë¡œì íŠ¸ ì´ì „/ë³µì‚¬ ìš©ì´ (DB ì „ì²´ ë¤í”„)

**ì‹œë‚˜ë¦¬ì˜¤:**
```bash
# í”„ë¡œì íŠ¸ ì „ì²´ ë°±ì—… (ë©”íƒ€ë°ì´í„° + ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°)
pg_dump project1_db > project1_full_backup.sql

# ë‹¤ë¥¸ ì„œë²„ë¡œ ì´ì „
psql -h new-server -d project1_db < project1_full_backup.sql

# âœ… ë©”íƒ€ë°ì´í„°ë„ ìë™ìœ¼ë¡œ í¬í•¨ë¨!
```

#### ì˜µì…˜ B: ì¤‘ì•™ metadb â­â­

**ë‹¨ì :**
- âš ï¸ í”„ë¡œì íŠ¸ ê°„ ë©”íƒ€ë°ì´í„°ê°€ metadbì— ì„ì„
- âš ï¸ í”„ë¡œì íŠ¸ ì´ì „ ì‹œ metadbì—ì„œ í•´ë‹¹ í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ í•„ìš”
- âš ï¸ í”„ë¡œì íŠ¸ ì‚­ì œ ì‹œ metadb ì •ë¦¬ í•„ìš”

**ì‹œë‚˜ë¦¬ì˜¤:**
```bash
# í”„ë¡œì íŠ¸ ë°±ì—… ì‹œ ë‘ ë‹¨ê³„ í•„ìš”
# 1. ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°
pg_dump project1_db > project1_business.sql

# 2. ë©”íƒ€ë°ì´í„° (í”„ë¡œì íŠ¸ë³„ í•„í„°ë§ í•„ìš”)
pg_dump metadb -t _metadata.mappings_table \
  --where="table_id IN (SELECT id FROM _metadata.project_tables WHERE project_id = 'project1')" \
  > project1_metadata.sql

# âš ï¸ ë³µì¡í•˜ê³  ì‹¤ìˆ˜ ê°€ëŠ¥ì„±
```

---

### 2. âœ… **í¬ë¡œìŠ¤ í”„ë¡œì íŠ¸ ì¡°íšŒ**

#### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata â­â­

**ë‹¨ì :**
- âš ï¸ ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ í•œ ë²ˆì— ì¡°íšŒí•˜ê¸° ì–´ë ¤ì›€
- âš ï¸ í”„ë¡œì íŠ¸ ê°„ ë©”íƒ€ë°ì´í„° ë¹„êµ/ë¶„ì„ ë³µì¡

**ì‹œë‚˜ë¦¬ì˜¤:**
```sql
-- âŒ ë¶ˆê°€ëŠ¥: ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ 'users' í…Œì´ë¸” ì°¾ê¸°
-- DBê°€ ë‹¬ë¼ì„œ í•œ ì¿¼ë¦¬ë¡œ ë¶ˆê°€ëŠ¥
```

#### ì˜µì…˜ B: ì¤‘ì•™ metadb â­â­â­â­â­

**ì¥ì :**
- âœ… ëª¨ë“  í”„ë¡œì íŠ¸ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ í•œ ì¿¼ë¦¬ë¡œ ì¡°íšŒ
- âœ… í”„ë¡œì íŠ¸ ê°„ ë©”íƒ€ë°ì´í„° ë¹„êµ ìš©ì´
- âœ… ì „ì²´ í†µê³„/ë¶„ì„ ì‰¬ì›€

**ì‹œë‚˜ë¦¬ì˜¤:**
```sql
-- âœ… ê°€ëŠ¥: ëª¨ë“  í”„ë¡œì íŠ¸ì—ì„œ 'email' ì»¬ëŸ¼ ì‚¬ìš©í•˜ëŠ” í…Œì´ë¸” ì°¾ê¸°
SELECT
    p.project_name,
    mt.table_name,
    mc.pg_column,
    mc.validation_rules
FROM _metadata.mappings_column mc
JOIN _metadata.mappings_table mt ON mc.table_id = mt.id
JOIN _metadata.project_tables pt ON pt.table_id = mt.id
JOIN _metadata.projects p ON pt.project_id = p.id
WHERE mc.pg_column = 'email';

-- âœ… ê²°ê³¼: ì „ì²´ í”Œë«í¼ì—ì„œ email ì»¬ëŸ¼ í˜„í™© íŒŒì•…
```

---

### 3. âœ… **ë©”íƒ€ë°ì´í„° ê³µìœ /ì¬ì‚¬ìš©**

#### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata â­â­

**ë‹¨ì :**
- âš ï¸ ê³µí†µ í…Œì´ë¸” ì •ì˜ë¥¼ ê° í”„ë¡œì íŠ¸ë§ˆë‹¤ ë³µì‚¬ í•„ìš”
- âš ï¸ ê³µí†µ í…Œì´ë¸” ë³€ê²½ ì‹œ ëª¨ë“  í”„ë¡œì íŠ¸ ìˆ˜ë™ ì—…ë°ì´íŠ¸

**ì‹œë‚˜ë¦¬ì˜¤:**
```sql
-- âŒ ë¹„íš¨ìœ¨: users í…Œì´ë¸” ì •ì˜ë¥¼ 3ê°œ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©
-- â†’ ê° í”„ë¡œì íŠ¸ DBì— ë™ì¼í•œ ë©”íƒ€ë°ì´í„° 3ë²ˆ ì…ë ¥
INSERT INTO project1_db._metadata.mappings_table (...); -- ì¤‘ë³µ
INSERT INTO project2_db._metadata.mappings_table (...); -- ì¤‘ë³µ
INSERT INTO project3_db._metadata.mappings_table (...); -- ì¤‘ë³µ

-- users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ
-- â†’ 3ê°œ í”„ë¡œì íŠ¸ ëª¨ë‘ ìˆ˜ë™ ì—…ë°ì´íŠ¸ í•„ìš”
```

#### ì˜µì…˜ B: ì¤‘ì•™ metadb â­â­â­â­â­

**ì¥ì :**
- âœ… ê³µí†µ í…Œì´ë¸” ì •ì˜ë¥¼ í•œ ë²ˆë§Œ ì €ì¥
- âœ… ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì—ì„œ ì°¸ì¡°ë§Œ ì¶”ê°€
- âœ… ê³µí†µ í…Œì´ë¸” ë³€ê²½ ì‹œ ìë™ ë°˜ì˜

**ì‹œë‚˜ë¦¬ì˜¤:**
```sql
-- âœ… íš¨ìœ¨: users í…Œì´ë¸” ì •ì˜ 1ë²ˆë§Œ ì €ì¥
INSERT INTO metadb._metadata.mappings_table (
    table_name, graphql_type, label, is_shared
) VALUES (
    'users', 'User', 'ì‚¬ìš©ì', true  -- shared í‘œì‹œ
);

-- 3ê°œ í”„ë¡œì íŠ¸ì—ì„œ ì°¸ì¡°ë§Œ ì¶”ê°€
INSERT INTO metadb._metadata.project_tables (project_id, table_id)
VALUES
    ('project1', (SELECT id FROM _metadata.mappings_table WHERE table_name = 'users')),
    ('project2', (SELECT id FROM _metadata.mappings_table WHERE table_name = 'users')),
    ('project3', (SELECT id FROM _metadata.mappings_table WHERE table_name = 'users'));

-- âœ… users ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ â†’ ëª¨ë“  í”„ë¡œì íŠ¸ ìë™ ë°˜ì˜!
```

---

### 4. âœ… **ì½”ë“œ ìƒì„± ë³µì¡ë„**

#### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata â­â­â­â­â­

**ì¥ì :**
- âœ… ì½”ë“œ ìƒì„±ê¸°ê°€ ë‹¨ìˆœí•¨ (1ê°œ DBë§Œ ì ‘ì†)
- âœ… í”„ë¡œì íŠ¸ë³„ ë…ë¦½ ì‹¤í–‰

**ì‹œë‚˜ë¦¬ì˜¤:**
```typescript
// ì½”ë“œ ìƒì„±ê¸°
async function generateCode(projectId: string) {
  const db = await connectDB(`${projectId}_db`);

  // í•´ë‹¹ DBì˜ _metadataì—ì„œ ì½ê¸°
  const tables = await db.query(`
    SELECT * FROM _metadata.mappings_table
  `);

  // ê°„ë‹¨!
}
```

#### ì˜µì…˜ B: ì¤‘ì•™ metadb â­â­â­

**ë‹¨ì :**
- âš ï¸ 2ê°œ DB ì—°ê²° í•„ìš” (metadb + project_db)
- âš ï¸ í”„ë¡œì íŠ¸ë³„ í•„í„°ë§ í•„ìš”

**ì‹œë‚˜ë¦¬ì˜¤:**
```typescript
// ì½”ë“œ ìƒì„±ê¸°
async function generateCode(projectId: string) {
  const metaDB = await connectDB('metadb');
  const projectDB = await connectDB(`${projectId}_db`);

  // 1. metadbì—ì„œ í•´ë‹¹ í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° ì¡°íšŒ
  const tables = await metaDB.query(`
    SELECT mt.*
    FROM _metadata.mappings_table mt
    JOIN _metadata.project_tables pt ON pt.table_id = mt.id
    JOIN _metadata.projects p ON pt.project_id = p.id
    WHERE p.project_id = $1
  `, [projectId]);

  // 2. projectDBì— DDL ìƒì„±
  // ì•½ê°„ ë³µì¡
}
```

---

### 5. âœ… **ì„±ëŠ¥**

#### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata â­â­â­â­â­

**ì¥ì :**
- âœ… ê° í”„ë¡œì íŠ¸ì˜ ë©”íƒ€ë°ì´í„°ë§Œ ì¡°íšŒ (ì‘ì€ ë°ì´í„°ì…‹)
- âœ… ì¸ë±ìŠ¤ íš¨ìœ¨ì 
- âœ… ë™ì‹œ ì ‘ì† ì‹œ DB ë¶„ì‚°

#### ì˜µì…˜ B: ì¤‘ì•™ metadb â­â­â­

**ë‹¨ì :**
- âš ï¸ metadbì— ëª¨ë“  í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° â†’ í…Œì´ë¸” í¬ê¸° ì¦ê°€
- âš ï¸ í”„ë¡œì íŠ¸ë³„ í•„í„°ë§ í•„ìš” (WHERE ì ˆ ì¶”ê°€)
- âš ï¸ ë™ì‹œ ì ‘ì† ì‹œ metadbê°€ ë³‘ëª©

**ì‹œë‚˜ë¦¬ì˜¤:**
```sql
-- ì˜µì…˜ A: ë¹ ë¦„
SELECT * FROM _metadata.mappings_table;  -- 10ê°œ í…Œì´ë¸”

-- ì˜µì…˜ B: ëŠë¦¼
SELECT * FROM _metadata.mappings_table
WHERE table_id IN (
  SELECT table_id FROM _metadata.project_tables
  WHERE project_id = 'project1'
);  -- 1000ê°œ í…Œì´ë¸” ì¤‘ 10ê°œ í•„í„°ë§
```

---

### 6. âœ… **ìœ ì§€ë³´ìˆ˜**

#### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata â­â­â­

**ë‹¨ì :**
- âš ï¸ ë©”íƒ€ë°ì´í„° ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ ëª¨ë“  í”„ë¡œì íŠ¸ DB ì—…ë°ì´íŠ¸ í•„ìš”
- âš ï¸ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ëª¨ë“  DBì— ì‹¤í–‰

**ì‹œë‚˜ë¦¬ì˜¤:**
```bash
# _metadata ìŠ¤í‚¤ë§ˆì— ìƒˆ ì»¬ëŸ¼ ì¶”ê°€ ì‹œ
for db in project1_db project2_db project3_db; do
  psql -d $db -c "ALTER TABLE _metadata.mappings_column ADD COLUMN new_field TEXT;"
done

# âš ï¸ í”„ë¡œì íŠ¸ ìˆ˜ë§Œí¼ ë°˜ë³µ
```

#### ì˜µì…˜ B: ì¤‘ì•™ metadb â­â­â­â­â­

**ì¥ì :**
- âœ… ë©”íƒ€ë°ì´í„° ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ metadbë§Œ ì—…ë°ì´íŠ¸
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ 1íšŒ ì‹¤í–‰

**ì‹œë‚˜ë¦¬ì˜¤:**
```bash
# _metadata ìŠ¤í‚¤ë§ˆì— ìƒˆ ì»¬ëŸ¼ ì¶”ê°€
psql -d metadb -c "ALTER TABLE _metadata.mappings_column ADD COLUMN new_field TEXT;"

# âœ… 1ë²ˆë§Œ ì‹¤í–‰
```

---

### 7. âœ… **í™•ì¥ì„±**

#### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata â­â­â­â­â­

**ì¥ì :**
- âœ… í”„ë¡œì íŠ¸ ìˆ˜ ë¬´ì œí•œ í™•ì¥ ê°€ëŠ¥
- âœ… ê° í”„ë¡œì íŠ¸ê°€ ë…ë¦½ì ìœ¼ë¡œ í™•ì¥
- âœ… ë‚˜ì¤‘ì— í”„ë¡œì íŠ¸ë³„ ì„œë²„ ë¶„ë¦¬ ê°€ëŠ¥

#### ì˜µì…˜ B: ì¤‘ì•™ metadb â­â­â­

**ë‹¨ì :**
- âš ï¸ í”„ë¡œì íŠ¸ ìˆ˜ ì¦ê°€ ì‹œ metadb í¬ê¸° ì¦ê°€
- âš ï¸ í”„ë¡œì íŠ¸ 100ê°œ+ ì‹œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥

---

### 8. âœ… **ê°œë°œ í¸ì˜ì„±**

#### ì˜µì…˜ A: í”„ë¡œì íŠ¸ë³„ _metadata â­â­â­â­

**ì¥ì :**
- âœ… ë¡œì»¬ ê°œë°œ ì‹œ 1ê°œ DBë§Œ ë³µì‚¬
- âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶• ì‰¬ì›€

**ì‹œë‚˜ë¦¬ì˜¤:**
```bash
# ë¡œì»¬ ê°œë°œ í™˜ê²½
pg_dump -h production -d project1_db | psql -h localhost -d project1_db

# âœ… ë©”íƒ€ë°ì´í„° + ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„° ëª¨ë‘ ë³µì‚¬ë¨
```

#### ì˜µì…˜ B: ì¤‘ì•™ metadb â­â­

**ë‹¨ì :**
- âš ï¸ ë¡œì»¬ ê°œë°œ ì‹œ metadb + project_db ë‘˜ ë‹¤ í•„ìš”
- âš ï¸ í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶• ë³µì¡

---

## ğŸ“‹ ì¢…í•© ë¹„êµí‘œ

| í•­ëª© | í”„ë¡œì íŠ¸ë³„ _metadata | ì¤‘ì•™ metadb | ì°¨ì´ |
|------|---------------------|-------------|------|
| **ë…ë¦½ì„±** | â­â­â­â­â­ ì™„ë²½í•œ ë…ë¦½ | â­â­ ê³µìœ ë¨ | ğŸ”´ í° ì°¨ì´ |
| **í¬ë¡œìŠ¤ ì¡°íšŒ** | â­â­ ì–´ë ¤ì›€ | â­â­â­â­â­ ì‰¬ì›€ | ğŸ”´ í° ì°¨ì´ |
| **ë©”íƒ€ë°ì´í„° ê³µìœ ** | â­â­ ì¤‘ë³µ ì €ì¥ | â­â­â­â­â­ ì¬ì‚¬ìš© | ğŸ”´ í° ì°¨ì´ |
| **ì½”ë“œ ìƒì„±** | â­â­â­â­â­ ë‹¨ìˆœ | â­â­â­ ì•½ê°„ ë³µì¡ | ğŸŸ¡ ì¤‘ê°„ ì°¨ì´ |
| **ì„±ëŠ¥** | â­â­â­â­â­ ë¹ ë¦„ | â­â­â­ í•„í„°ë§ í•„ìš” | ğŸŸ¡ ì¤‘ê°„ ì°¨ì´ |
| **ìœ ì§€ë³´ìˆ˜** | â­â­â­ ë°˜ë³µ ì‘ì—… | â­â­â­â­â­ ì¤‘ì•™ ê´€ë¦¬ | ğŸŸ¡ ì¤‘ê°„ ì°¨ì´ |
| **í™•ì¥ì„±** | â­â­â­â­â­ ë¬´ì œí•œ | â­â­â­ ì œí•œì  | ğŸŸ¡ ì¤‘ê°„ ì°¨ì´ |
| **ê°œë°œ í¸ì˜ì„±** | â­â­â­â­ ë‹¨ìˆœ | â­â­ ë³µì¡ | ğŸŸ¡ ì¤‘ê°„ ì°¨ì´ |
| **ë°±ì—…/ë³µì›** | â­â­â­â­â­ ì‰¬ì›€ | â­â­ ë³µì¡ | ğŸ”´ í° ì°¨ì´ |

---

## ğŸ¯ ìƒí™©ë³„ ì¶”ì²œ

### ğŸ¥‡ í”„ë¡œì íŠ¸ë³„ _metadata ì„ íƒ (ì˜µì…˜ A)

ë‹¤ìŒ ê²½ìš°ì— **ê°•ë ¥ ì¶”ì²œ**:

1. **í”„ë¡œì íŠ¸ê°€ ì™„ì „íˆ ë…ë¦½ì **
   - ê° í”„ë¡œì íŠ¸ê°€ ì„œë¡œ ë‹¤ë¥¸ ê³ ê°/ì¡°ì§
   - í”„ë¡œì íŠ¸ ê°„ ë°ì´í„°/ë©”íƒ€ë°ì´í„° ê³µìœ  ë¶ˆí•„ìš”

2. **í”„ë¡œì íŠ¸ë³„ ë°°í¬/ì´ì „ ë¹ˆë²ˆ**
   - SaaS ë©€í‹°í…Œë„Œì‹œ (ê° ê³ ê°ì´ ë³„ë„ í”„ë¡œì íŠ¸)
   - í”„ë¡œì íŠ¸ë¥¼ ë‹¤ë¥¸ ì„œë²„ë¡œ ì´ì „í•  ê°€ëŠ¥ì„±

3. **ê°„ë‹¨í•¨ ìš°ì„ **
   - ì½”ë“œ ìƒì„±ê¸° ë‹¨ìˆœí•˜ê²Œ ìœ ì§€
   - ê°œë°œì í•™ìŠµ ê³¡ì„  ë‚®ì¶”ê¸°

4. **í™•ì¥ì„± ì¤‘ìš”**
   - í”„ë¡œì íŠ¸ ìˆ˜ê°€ ë§ê±°ë‚˜ ê³„ì† ì¦ê°€
   - ë‚˜ì¤‘ì— í”„ë¡œì íŠ¸ë³„ ì„œë²„ ë¶„ë¦¬ ê°€ëŠ¥ì„±

**ì˜ˆì‹œ ìƒí™©:**
```
- ê³ ê°ë³„ ë…ë¦½ í”„ë¡œì íŠ¸ (ê³ ê° A, ê³ ê° B, ...)
- ì œí’ˆë³„ ë…ë¦½ í”„ë¡œì íŠ¸ (ì œí’ˆ X, ì œí’ˆ Y, ...)
- í™˜ê²½ë³„ ë³µì‚¬ (dev, staging, production)
```

---

### ğŸ¥ˆ ì¤‘ì•™ metadb ì„ íƒ (ì˜µì…˜ B)

ë‹¤ìŒ ê²½ìš°ì— **ì¶”ì²œ**:

1. **í”„ë¡œì íŠ¸ ê°„ ë©”íƒ€ë°ì´í„° ê³µìœ  í•„ìš”**
   - ê³µí†µ í…Œì´ë¸” ì •ì˜ ì¬ì‚¬ìš© (users, settings, ...)
   - ê³µí†µ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ ìë™ ë°˜ì˜

2. **ì „ì²´ í”Œë«í¼ í†µí•© ê´€ë¦¬**
   - ëª¨ë“  í”„ë¡œì íŠ¸ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ í•œëˆˆì— íŒŒì•…
   - í¬ë¡œìŠ¤ í”„ë¡œì íŠ¸ ë¶„ì„/í†µê³„

3. **ë©”íƒ€ë°ì´í„° ì¤‘ì•™ ì œì–´**
   - ê´€ë¦¬ìê°€ ëª¨ë“  í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„° ê´€ë¦¬
   - í‘œì¤€ ìŠ¤í‚¤ë§ˆ ê°•ì œ

4. **í”„ë¡œì íŠ¸ ìˆ˜ê°€ ì ê³  ì•ˆì •ì **
   - 10ê°œ ì´í•˜ì˜ í”„ë¡œì íŠ¸
   - í”„ë¡œì íŠ¸ ì¶”ê°€/ì‚­ì œ ë“œë­„

**ì˜ˆì‹œ ìƒí™©:**
```
- ê°™ì€ íšŒì‚¬ì˜ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ (ì„œë¹„ìŠ¤ A, ì„œë¹„ìŠ¤ B, ...)
- ê³µí†µ í”Œë«í¼ + ì—¬ëŸ¬ ì•±
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ (ê³µí†µ ë©”íƒ€ë°ì´í„°)
```

---

## ğŸ’¡ ìµœì¢… ì¶”ì²œ

### ë‹¹ì‹ ì˜ ìƒí™©: Ubuntu í”Œë«í¼ + ì—¬ëŸ¬ í”„ë¡œì íŠ¸

**ì¶”ì²œ: ì˜µì…˜ A (í”„ë¡œì íŠ¸ë³„ _metadata)** â­â­â­â­â­

**ì´ìœ :**

1. **ì™„ë²½í•œ ë…ë¦½ì„±**
   ```bash
   # í”„ë¡œì íŠ¸ ì „ì²´ ë°±ì—…/ì´ì „ ê°„ë‹¨
   pg_dump project1_db > backup.sql
   ```

2. **ê°„ë‹¨í•œ ì½”ë“œ ìƒì„±**
   ```typescript
   // 1ê°œ DBë§Œ ì ‘ì†
   const db = await connectDB(`${projectId}_db`);
   ```

3. **í™•ì¥ ê°€ëŠ¥**
   ```
   í”„ë¡œì íŠ¸ 10ê°œë“  100ê°œë“  ë¬¸ì œì—†ìŒ
   ë‚˜ì¤‘ì— í”„ë¡œì íŠ¸ë³„ ì„œë²„ ë¶„ë¦¬ë„ ê°€ëŠ¥
   ```

4. **ê°œë°œ í¸ì˜**
   ```bash
   # ë¡œì»¬ ê°œë°œ ì‹œ 1ê°œ DBë§Œ ë³µì‚¬
   pg_dump project1_db | psql -h localhost
   ```

---

## ğŸ”„ í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ (ì„ íƒì‚¬í•­)

í•„ìš”í•˜ë‹¤ë©´ ë‘ ê°€ì§€ ì¥ì ì„ ê²°í•©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```
PostgreSQL ì„œë²„
â”œâ”€â”€ metadb (ê³µí†µ ë©”íƒ€ë°ì´í„°ë§Œ)
â”‚   â””â”€â”€ _metadata schema
â”‚       â”œâ”€â”€ shared_tables (ê³µí†µ í…Œì´ë¸” ì •ì˜)
â”‚       â””â”€â”€ projects (í”„ë¡œì íŠ¸ ëª©ë¡)
â”‚
â”œâ”€â”€ project1_db
â”‚   â”œâ”€â”€ _metadata schema (í”„ë¡œì íŠ¸ë³„ ë©”íƒ€ë°ì´í„°)
â”‚   â”‚   â””â”€â”€ mappings_table â†’ shared_tables ì°¸ì¡° ê°€ëŠ¥
â”‚   â””â”€â”€ public schema
â”‚
â””â”€â”€ project2_db
    â”œâ”€â”€ _metadata schema (í”„ë¡œì íŠ¸ë³„ ë©”íƒ€ë°ì´í„°)
    â””â”€â”€ public schema
```

**ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**
- 80%: í”„ë¡œì íŠ¸ë³„ _metadata ì‚¬ìš© (ë…ë¦½ì„±)
- 20%: metadbì˜ shared_tables ì°¸ì¡° (ê³µí†µ ì •ì˜)

---

## ğŸ“ êµ¬í˜„ ê°€ì´ë“œ

### ì˜µì…˜ A êµ¬í˜„ (í”„ë¡œì íŠ¸ë³„)

```sql
-- 1. í”„ë¡œì íŠ¸ DB ìƒì„±
CREATE DATABASE project1_db;

-- 2. _metadata schema ìƒì„±
\c project1_db
CREATE SCHEMA _metadata;

-- 3. ë©”íƒ€ë°ì´í„° í…Œì´ë¸” ìƒì„±
CREATE TABLE _metadata.mappings_table ( ... );
CREATE TABLE _metadata.mappings_column ( ... );
-- ...

-- 4. í”„ë¡œì íŠ¸ë³„ ë…ë¦½ ì‚¬ìš©
```

### ì˜µì…˜ B êµ¬í˜„ (ì¤‘ì•™)

```sql
-- 1. ì¤‘ì•™ metadb ìƒì„±
CREATE DATABASE metadb;

-- 2. _metadata schema ìƒì„±
\c metadb
CREATE SCHEMA _metadata;

-- 3. ë©”íƒ€ë°ì´í„° í…Œì´ë¸” ìƒì„± (projects í…Œì´ë¸” í•„ìˆ˜)
CREATE TABLE _metadata.projects ( ... );
CREATE TABLE _metadata.mappings_table ( ... );
CREATE TABLE _metadata.project_tables ( ... );
-- ...

-- 4. í”„ë¡œì íŠ¸ DBëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„°ë§Œ
CREATE DATABASE project1_db;
```

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### í”„ë¡œì íŠ¸ë³„ _metadata ì„ íƒ ì‹œ

- [ ] ê° í”„ë¡œì íŠ¸ DBì— _metadata schema ìƒì„±
- [ ] í”„ë¡œì íŠ¸ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì¤€ë¹„
- [ ] ë°±ì—…/ë³µì› ìŠ¤í¬ë¦½íŠ¸ (DB ë‹¨ìœ„)
- [ ] ì½”ë“œ ìƒì„±ê¸° (1ê°œ DB ì ‘ì†)

### ì¤‘ì•™ metadb ì„ íƒ ì‹œ

- [ ] metadb ìƒì„± ë° ì´ˆê¸°í™”
- [ ] projects í…Œì´ë¸”ë¡œ í”„ë¡œì íŠ¸ ê´€ë¦¬
- [ ] project_tables í…Œì´ë¸”ë¡œ ë§¤í•‘ ê´€ë¦¬
- [ ] ì½”ë“œ ìƒì„±ê¸° (2ê°œ DB ì ‘ì†)
- [ ] í”„ë¡œì íŠ¸ë³„ ë©”íƒ€ë°ì´í„° í•„í„°ë§ ë¡œì§

---

**ë¬¸ì„œ ìœ„ì¹˜**: `/var/services/homes/jungsam/dev/dockers/_templates/docker/docker-ubuntu/_docs/meta-data-driven/workflows/`

**ë²„ì „**: 1.0.0

**ì‘ì„±ì¼**: 2024-10-19
